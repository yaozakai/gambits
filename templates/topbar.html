<header>
<!--    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet" />
    <div class="container-fluid" id="top-navbar">
        <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark"
        {% if current_user.is_authenticated %}
             id="top_bar">
        {% else %}
            id="top_bar_not_logged">
        {% endif %}
          <div class="top-bar-desktop">
<!-- LOGO -->
            <a class="navbar-brand" href="/">
              <img src="{{ static_path }}/icons/ui/favicon.png" style="height: 25px;">
              <img src="{{ static_path }}/icons/ui/main_title.png" class="main-logo">
            </a>

<!-- BALANCE (if logged in) -->
            {% if current_user.is_authenticated %}
              <div class="green-text login-data">
                  Hi {{ current_user.username }} ♥️🙏🏼
                  <div class="balanceBox" id="balance" data-toggle="tooltip" data-placement="bottom" title="Balance refreshes every 30 seconds">
                      {{ current_user.balance }} {{ current_user.currency }}
                  </div>
              </div>
            {% endif %}
<!-- SOCIALS (Desktop) -->
<!--            <a class="navbar        d" href="https://discord.gg/ebjsys6h">-->
<!--                <i class="bi bi-discord"></i>-->
<!--            </a>-->
<!--            <a class="navbar-brand" href="https://twitter.com/cryptoraiderio">-->
<!--                <i class="bi bi-twitter"></i>-->
<!--            </a>-->
            <div class="top-bar-right-side">
                {% if current_user.is_authenticated and session['admin'] %}
                    <a class="btn btn-outline-success" href="/search"><i class="bi bi-search"></i></a>
                {% endif %}

                <div class="dropdown">
                    <form method="POST">
                        <button class="btn btn-outline-success dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="flag-icon flag-icon-{{ session['flag'] }} me-1"></span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1" id="language-select" >
                            <li >
                                <button class="dropdown-item" name="language-select" value="en" id="lang-en"><span class="flag-icon flag-icon-gb me-1"></span> <span>English</span></button>
                            </li>
                            <li >
                                <button class="dropdown-item" name="language-select" value="zh-tw" id="lang-zh-tw"><span class="flag-icon flag-icon-tw me-1"></span> <span>繁體中文</span></button>
                            </li>
                            <li >
                                <button class="dropdown-item" name="language-select" value="zh-cn" id="lang-zh-cn"><span class="flag-icon flag-icon-cn me-1"></span> <span>简体中文</span></button>
                            </li>
                            <li >
                                <button class="dropdown-item" name="language-select" value="ja" id="lang-ja"><span class="flag-icon flag-icon-jp me-1"></span> <span>日本</span></button>
                            </li>
                            <li >
                                <button class="dropdown-item" name="language-select" value="id" id="lang-id"><span class="flag-icon flag-icon-id me-1"></span> <span>Bahasa</span></button>
                            </li>
                            <li >
                                <button class="dropdown-item" name="language-select" value="kr" id="lang-kr"><span class="flag-icon flag-icon-kr me-1"></span> <span>한국어</span></button>
                            </li>
                            <li >
                                <button class="dropdown-item" name="language-select" value="vn" id="lang-vn"><span class="flag-icon flag-icon-vn me-1"></span> <span>Việt</span></button>
                            </li>
                            <li >
                                <button class="dropdown-item" name="language-select" value="br" id="lang-br"><span class="flag-icon flag-icon-br me-1"></span> <span>Português</span></button>
                            </li>
                            <li >
                                <button class="dropdown-item" name="language-select" value="es" id="lang-es"><span class="flag-icon flag-icon-es me-1"></span> <span>Española</span></button>
                            </li>
                        </ul>
                    </form>
                </div>
<!--                <form method="POST" style="display: inline;">-->
<!--                    <select id="language-select" name="language-select" class="green-text" onchange="this.form.submit();">-->

<!--                        <option value="en" id="lang-en"><img src="{{ static_path }}/icons/flags/en.svg">English</option>-->
<!--                        <option value="zh-tw" id="lang-zh-tw">繁體中文</option>-->
<!--                        <option value="zh-cn" id="lang-zh-cn">简体中文</option>-->
<!--                        <option value="ja" id="lang-ja">日本</option>-->
<!--                        <option value="id" id="lang-id">Bahasa</option>-->
<!--                        <option value="ko" id="lang-ko">한국어</option>-->
<!--                        <option value="vi" id="lang-vi">Việt</option>-->
<!--                        <option value="pt-br" id="lang-pt-br">Português</option>-->
<!--                        <option value="es" id="lang-es">Española</option>-->

<!--                    </select>-->
                    <script>
                        $(document).ready(function(){
                            active_lang = document.getElementById("lang-" + "{{ session['lang'] }}");
                            active_lang.classList.add("active");

                        });
                    </script>
<!--                </form>-->

<!-- PROFILE/LOGOUT (if logged in) -->
                {% if current_user.is_authenticated %}
                    <a class="btn btn-outline-success" href="/profile">{{ translations['profile'][session['lang']] }}</a>
                    <a class="btn btn-outline-success" href="/logout">{{ translations['log out'][session['lang']] }}</a>
                {% else %}
<!-- LOGIN/REGISTER (if NOT logged in) -->
                    <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#loginModal">
                      <div >{{ translations['log in'][session['lang']] }}</div>
                    </button>
                    <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#registerModal">
                      <div >{{ translations['register'][session['lang']] }}</div>
                    </button>
                {% endif %}
            </div>
          </div>


<!-- MOBILE -->
            <div class="top-bar-mobile">
            <!-- LOGO -->
                <a href="/"><img src="{{ static_path }}/icons/ui/main_title.png" class="main-logo"></a>
                <!-- SOCIALS -->
                <!--              <div>-->
                <!--                  <a class="navbar-brand" href="https://discord.gg/ebjsys6h">-->
                <!--                    <i class="bi bi-discord"></i>-->
                <!--                  </a>-->
                <!--                  <a class="navbar-brand" href="https://twitter.com/cryptoraiderio">-->
                <!--                    <i class="bi bi-twitter"></i>-->
                <!--                  </a>-->
                <!--              </div>-->
                <div id="top-bar-mobile-right">
                    {% if current_user.is_authenticated %}
                        <a class="btn btn-outline-success" href="/profile">{{ translations['profile'][session['lang']] }}</a>
                        <a class="btn btn-outline-success" href="/logout">{{ translations['log out'][session['lang']] }}</a>
                    {% else %}
                        <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#loginModal">
                          <div >{{ translations['log in'][session['lang']] }}</div>
                        </button>
                        <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#registerModal">
                          <div >{{ translations['register'][session['lang']] }}</div>
                        </button>
                    {% endif %}
                </div>
                {% if current_user.is_authenticated %}
                    <div class="green-text login-data-mobile">
                        <div style="float: left;padding-top: 8px;padding-left: 3px;"> Hi {{ current_user.username }} ♥️🙏🏼</div>

                        <div style="float: right;">
                            <div class="btn btn-transparent" id="refresh_balance" style="height: 43px; display: inline-block;">
                                <h3><i class="bi bi-arrow-clockwise"></i></h3>
                            </div>
                            <div class="balanceBox" id="balance2" data-toggle="tooltip" data-placement="bottom" title="Balance refreshes every 30 seconds">
                              {{ current_user.balance }} {{ current_user.currency }}
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </nav>
    </div>
</header>

<script language="JavaScript" type="text/javascript">
    $(document).ready(function(){
        function set_lang() {
<!--            var balance_field = document.getElementById("balance");-->

        }
    });
</script>

{% if current_user.is_authenticated %}
    <script language="JavaScript" type="text/javascript">
    $(document).ready(function(){
        var balance_field = document.getElementById("balance");
        var balance_field2 = document.getElementById("balance2");
        function updater() {
            fetch('/getBalance')
            .then(response => response.text())
            .then(text => (balance_field.innerHTML = text))  // update page with new data
            .then(text => (balance_field2.innerHTML = text));  // update page with new data
        }
        $('#refresh_balance').on('click', function(){
            updater();
        });
        setInterval(updater, 30000);  // run `updater()` every (30s)
        window.scrollTo(0, 0);
    });
    </script>
{% endif %}